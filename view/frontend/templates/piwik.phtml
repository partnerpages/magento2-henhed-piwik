<?php
/**
 * Copyright 2016 Henrik Hedelund
 *
 * This file is part of Partnerpages_Piwik.
 *
 * Partnerpages_Piwik is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Partnerpages_Piwik is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Partnerpages_Piwik.  If not, see <http://www.gnu.org/licenses/>.
 */

?>
<?php /* @var $block \Partnerpages\Piwik\Block\Piwik */ ?>
<script type="text/x-magento-init">
<?php echo $block->jsonEncode([
    '*' => [
        'Partnerpages_Piwik/js/tracker' => $block->getJsOptions()
    ]
]); ?>
</script>
<?php
// The following script can be omitted in which case the
// `Partnerpages_Piwik/js/tracker' component will inject the tracker script instead.
// However that might cause the tracker script to miss the `DOMContentLoaded'
// event which breaks the link tracking feature.
?>
<script type="text/javascript">
(function (d) {
    var g = d.createElement('script'),
        s = d.getElementsByTagName('script')[0];
    g.type = 'text/javascript';
    g.async = true;
    g.defer = true;
    g.src = '<?php echo $block->escapeJsQuote($block->getScriptUrl()); ?>';
    s.parentNode.insertBefore(g, s);
})(document);
</script>
<noscript>
    <p>
        <img src="<?php echo $block->getTrackingPixelUrl(); ?>"
             style="border: 0;"
             alt="" />
    </p>
</noscript>
